I"¬z<p>Just about every project needs a logging system.  In the early days of development, you need to output data to the console so you aren‚Äôt setting breakpoints in your code all over the place (or you are running the code in the browser, where breakpoints are more difficult).  Later on, you want logging to let you know where people are spending their time, or how much usage a particular feature gets.  It also helps with diagnosing problems early so that you can get ahead of the issues.</p>

<p>There are a ton of logging frameworks out there.  A <a href="https://www.npmjs.com/search?q=logging%20framework">search on npmjs.org</a> gives us over 150 results and the ‚Äúlogger‚Äù tag provides over 2700 packages to choose from, from the venerable ones (<a href="https://www.npmjs.com/package/morgan">Morgan</a> and <a href="https://www.npmjs.com/package/winston">Winston</a>) to newcomers (<a href="https://www.npmjs.com/package/pino">Pino</a> and <a href="https://www.npmjs.com/package/consola">consola</a>).  How does one choose with all this going on?</p>

<p>Fortunately, logging isn‚Äôt hard.  However, if you want to offer a pluggable logging architecture, you need some requirements:</p>

<ol>
  <li>Logging should not interfere with the regular operation of your app.  If it does, you have failed.</li>
  <li>You should be able to attach log destinations easily.</li>
  <li>You should be able to log at different levels (trace, debug, info, warning, error).</li>
  <li>You should be able to log at different levels in different areas of your app.</li>
</ol>

<p>The levels come from POSIX logging and are granular enough to deal with just about everything.</p>

<p>Why roll your own?  There are two reasons:</p>

<ol>
  <li>It‚Äôs a good idea to reduce dependencies within your code.  If a downstream dependency makes a breaking change, it breaks your app.  Logging should not break things.</li>
  <li>Writing your own reduces the size of the transpiled code, meaning it loads faster.  This is because the code is really not that complex.</li>
</ol>

<p>I tend to err on writing my own code unless the library has some definable benefit that I won‚Äôt take the time to replicate.  I‚Äôll use frameworks like React or Angular, since it‚Äôs unlikely I will be able to replicate the functionality easily and there is no benefit to me doing so.  However, logging frameworks allow me to remove a dependency and control the size of the resulting code.</p>

<p>The way I produce this code is to have two parts linked by an event emitter.  The first part is a logger.  Your code calls this to send logs into the event emitter.  The second part is a receiver - it‚Äôs job is to actually send the logs where they are going.  <code class="highlighter-rouge">EventEmitter</code> is standard in Node applications for a pub/sub type asynchronous message passing system.  If you are within a browser, you can use the <code class="highlighter-rouge">events</code> npm module to simulate the same thing.</p>

<blockquote>
  <p><strong>Interesting Factoid</strong>:  Most of the popular logging frameworks use event emitters under the covers!</p>

  <h2 id="the-logmanager">The LogManager</h2>
</blockquote>

<p>The LogManager handles configuration and management of the logging system:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">EventEmitter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">LogManager</span> <span class="kd">extends</span> <span class="nx">EventEmitter</span> <span class="p">{</span>
  <span class="kr">private</span> <span class="nx">options</span><span class="p">:</span> <span class="nx">LogOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">minLevels</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">''</span><span class="p">:</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// Prevent the console logger from being added twice</span>
  <span class="kr">private</span> <span class="na">consoleLoggerRegistered</span><span class="p">:</span> <span class="nx">boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="kr">public</span> <span class="nx">configure</span><span class="p">(</span><span class="na">options</span><span class="p">:</span> <span class="nx">LogOptions</span><span class="p">):</span> <span class="nx">LogManager</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">getLogger</span><span class="p">(</span><span class="na">module</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">Logger</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">minLevel</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">match</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">minLevels</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">module</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">minLevel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">minLevels</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">module</span><span class="p">,</span> <span class="nx">minLevel</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">public</span> <span class="nx">onLogEntry</span><span class="p">(</span><span class="na">listener</span><span class="p">:</span> <span class="p">(</span><span class="na">logEntry</span><span class="p">:</span> <span class="nx">LogEntry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">):</span> <span class="nx">LogManager</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">log</span><span class="dl">'</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// public registerConsoleLogger()</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">LogEntry</span> <span class="p">{</span>
  <span class="na">level</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nl">module</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nx">location</span><span class="p">?:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nl">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">LogOptions</span> <span class="p">{</span>
  <span class="na">minLevels</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="na">module</span><span class="p">:</span> <span class="nx">string</span><span class="p">]:</span> <span class="nx">string</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">logging</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LogManager</span><span class="p">();</span>
</code></pre></div></div>

<p>I‚Äôll come on to the details of a logger and log listener in a bit.  First, let‚Äôs dissect this small amount of code, because it does a lot.  Firstly, let‚Äôs talk about modules.  This is a hierarchical string that describes where you are in your code.  I use it by swapping the slashes for periods.  Thus, if I am in file <code class="highlighter-rouge">lib/my-class</code> within <code class="highlighter-rouge">MyClass</code>, I will use <code class="highlighter-rouge">lib.my-class.MyClass</code> as the module name.</p>

<p>The <code class="highlighter-rouge">getLogger()</code> method returns a logger that you can use.  Part of the process here is to work out what the minLevel is for this module.  I have a hierarchy of minLevels.  For instance, I might configure the log manager like this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">logManager</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span> <span class="na">minLevels</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">''</span><span class="p">:</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">lib</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">lib.my-class</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span>
<span class="p">}});</span>
</code></pre></div></div>

<p>The most specific module wins.  For my hypothetical <code class="highlighter-rouge">MyClass</code> class, I‚Äôd have a minLevel of debug.  However, if I registered <code class="highlighter-rouge">lib.other-class</code>, then that would have a minLevel of info.  This allows me to nicely control the amount that I log on a per logger basis.</p>

<p>Let‚Äôs take a look at the Logger next:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Logger</span> <span class="p">{</span>
    <span class="kr">private</span> <span class="nx">logManager</span><span class="p">:</span> <span class="nx">EventEmitter</span><span class="p">;</span>
    <span class="kr">private</span> <span class="nx">minLevel</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>
    <span class="kr">private</span> <span class="nx">module</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="kr">private</span> <span class="nx">readonly</span> <span class="nx">levels</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">key</span><span class="p">:</span> <span class="nx">string</span><span class="p">]:</span> <span class="nx">number</span> <span class="p">}</span> <span class="o">=</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">trace</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">};</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="nx">logManager</span><span class="p">:</span> <span class="nx">EventEmitter</span><span class="p">,</span> <span class="nx">module</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">minLevel</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logManager</span> <span class="o">=</span> <span class="nx">logManager</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">module</span> <span class="o">=</span> <span class="nx">module</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">minLevel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levelToInt</span><span class="p">(</span><span class="nx">minLevel</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Converts a string level (trace/debug/info/warn/error) into a number 
     * 
     * @param minLevel 
     */</span>
    <span class="kr">private</span> <span class="nx">levelToInt</span><span class="p">(</span><span class="nx">minLevel</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">number</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">minLevel</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">minLevel</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()];</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="mi">99</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Central logging method.
     * @param logLevel 
     * @param message 
     */</span>
    <span class="kr">public</span> <span class="nx">log</span><span class="p">(</span><span class="nx">logLevel</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">level</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levelToInt</span><span class="p">(</span><span class="nx">logLevel</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">level</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">minLevel</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="kd">const</span> <span class="na">logEntry</span><span class="p">:</span> <span class="nx">LogEntry</span> <span class="o">=</span> <span class="p">{</span> <span class="na">level</span><span class="p">:</span> <span class="nx">logLevel</span><span class="p">,</span> <span class="na">module</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">module</span><span class="p">,</span> <span class="nx">message</span> <span class="p">};</span>

        <span class="c1">// Obtain the line/file through a thoroughly hacky method</span>
        <span class="c1">// This creates a new stack trace and pulls the caller from it.  If the caller</span>
        <span class="c1">// if .trace()</span>
        <span class="kd">const</span> <span class="nx">error</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">cla</span> <span class="o">=</span> <span class="nx">error</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="se">\n</span><span class="dl">"</span><span class="p">);</span>
            <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">cla</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">cla</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">at Logger.Object.</span><span class="dl">"</span><span class="p">))</span> <span class="nx">idx</span><span class="o">++</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">cla</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">logEntry</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">cla</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="nx">cla</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="dl">"</span><span class="s2">at </span><span class="dl">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">cla</span><span class="p">[</span><span class="nx">idx</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">logManager</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">log</span><span class="dl">'</span><span class="p">,</span> <span class="nx">logEntry</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="nx">trace</span><span class="p">(</span><span class="na">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">trace</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span> <span class="p">}</span>
    <span class="kr">public</span> <span class="nx">debug</span><span class="p">(</span><span class="na">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span> <span class="p">}</span>
    <span class="kr">public</span> <span class="nx">info</span><span class="p">(</span><span class="na">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="k">void</span>  <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span> <span class="p">}</span>
    <span class="kr">public</span> <span class="nx">warn</span><span class="p">(</span><span class="na">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="k">void</span>  <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span> <span class="p">}</span>
    <span class="kr">public</span> <span class="nx">error</span><span class="p">(</span><span class="na">message</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The main function here is the <code class="highlighter-rouge">log()</code> method.  This constructs a <code class="highlighter-rouge">LogEntry</code> and emits it to the event emitter to be gathered by whatever listeners you have defined.  Note the curious code within the center.  It tries to find a location for the log message by constructing an Error object.  The Error object usually contains a stack trace that can be used to determine the location in your code.</p>

<p>Let‚Äôs see how your code will call this.  At the entrypoint to your application, set up logging.  If you just want the defaults, nothing need be done.  However, you usually want to set up a log destination.  I provide a console log driver in my example code:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kr">public</span> <span class="nx">registerConsoleLogger</span><span class="p">():</span> <span class="nx">LogManager</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">consoleLoggerRegistered</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">onLogEntry</span><span class="p">((</span><span class="nx">logEntry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">logEntry</span><span class="p">.</span><span class="nx">location</span><span class="p">}</span><span class="s2"> [</span><span class="p">${</span><span class="nx">logEntry</span><span class="p">.</span><span class="nx">module</span><span class="p">}</span><span class="s2">] </span><span class="p">${</span><span class="nx">logEntry</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">logEntry</span><span class="p">.</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="dl">'</span><span class="s1">trace</span><span class="dl">'</span><span class="p">:</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span><span class="p">:</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">:</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">:</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">:</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="nl">default</span><span class="p">:</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`{</span><span class="p">${</span><span class="nx">logEntry</span><span class="p">.</span><span class="nx">level</span><span class="p">}</span><span class="s2">} </span><span class="p">${</span><span class="nx">msg</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">consoleLoggerRegistered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>You can see how to register a new log driver from this code.  The important thing to note here is that you are already in an async context from your main code, so the activities on the log driver don‚Äôt affect your code.  The code, once transpiled and minified, is less than 8K, most of which is the EventEmitter code.</p>

<p>Back to setting up the code:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">logging</span><span class="p">,</span> <span class="nx">LogEntry</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./lib/logging</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">logging</span>
  <span class="p">.</span><span class="nx">configure</span><span class="p">({</span>
    <span class="na">minLevels</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">''</span><span class="p">:</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">core</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">registerConsoleLogger</span><span class="p">();</span>
</code></pre></div></div>

<p>You can do this at the entrypoint.  Then, in each file that you want to log:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">logging</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./lib/logging</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">logging</span><span class="p">.</span><span class="nx">getLogger</span><span class="p">(</span><span class="dl">'</span><span class="s1">core.module-name</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Later on</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`This is my log message`</span><span class="p">);</span>
</code></pre></div></div>

<p>The log message will get dumped to the console.  By writing my own, I can also enforce semantic logging (where you structure the text output so it is easily parsed - for example, by using key=value pairs) or even structured logging (where you record the data as JSON for even easier parsing).</p>

:ET