I"±—<p>There are lots of tutorials about creating an <a href="https://aws.amazon.com/appsync">AWS AppSync</a> API from the ground up using the console. However, sooner or later, you are going to want to create an API for production.</p>

<p>You could, just as simply, point-and-click your way around the console to produce the same API. However, that is fraught with problems. You can‚Äôt check that API into source code control, nor can you repeatedly deploy the API. Ultimately, you‚Äôll want to automate your deployments.</p>

<p>This article is about how you can automate your AWS AppSync deployments.</p>

<h2 id="get-used-to-the-terminology">Get used to the terminology</h2>

<p>I‚Äôm going to start using some terminology here that is unique to <a href="https://aws.amazon.com/cloudformation">AWS CloudFormation</a>. Just so we don‚Äôt get confused:</p>

<p>A <em>CloudFormation template</em> is a JSON or YAML file that describes what you are going to deploy. I like YAML for this sort of thing. I also use Visual Studio Code and there is <a href="https://marketplace.visualstudio.com/items?itemName=DanielThielking.aws-cloudformation-yaml">an extension specifically for editing CloudFormation YAML</a>.</p>

<p>A <em>CloudFormation stack</em> is an implementation of your template. You will run a command line tool (the AWS CLI) to create the stack or delete the stack. When the stack is created, all the resources are created. When the stack is deleted, well‚Ää‚Äî‚Ääall the resources are deleted.</p>

<p>A <em>CloudFormation resource</em> is a description of an AWS resource. It has all the settings for that resources. Resources can depend on other resources, and you can specify this dependency in the template.</p>

<h2 id="design-your-resource-hierarchy">Design your resource hierarchy</h2>

<p>Ultimately, I want to build an AWS AppSync API for my notes app. However, that comes with a multitude of other things. I need to specify the schema, resolvers, data sources, DynamoDB table, Amazon Cognito user pool, and any IAM roles that I need to use to link them together.</p>

<p>A CloudFormation stack is practically never a single resource. Let‚Äôs look at the dependency tree for my notes app:</p>

<p><img src="/assets/images/2018-04-17-image1.png" alt="" /></p>

<p>Note that almost everything has a <em>Ref</em> link. A ref link means that the configuration (and hence the CloudFormation template) is going to include a reference to the thing it depends on. This results in a natural order to creating things:</p>

<ol>
  <li>The Cognito user pool and DynamoDB table are created first.</li>
  <li>The Cognito application is created next.</li>
  <li>The GraphQL API is created after that.</li>
  <li>Then, the GraphQL schema and the data sources are created.</li>
  <li>Finally, the GraphQL resolver is created.</li>
</ol>

<p>I have not included the IAM roles or the IAM policies here which need to be created prior to the resources that use them. I will need two roles each with their own policy:</p>

<ul>
  <li>Amazon Cognito will need to publish via SNS to handle multi-factor authentication and the confirmation of user sign-ups.</li>
  <li>AWS AppSync will need to read and write to the Amazon DynamoDB table.</li>
</ul>

<p>When you are going through the configuration with the console, you will note this ordering implicitly is enforced. You can‚Äôt create a data source until the table is created, for instance.</p>

<p>The only link that doesn‚Äôt have a reference is the resolver linkage to the schema. The linkage between these two resources is embedded in the text of the GraphQL schema in the form of the name of the queries and mutations.</p>

<p>Since we can‚Äôt get the list of queries and mutations as the output of the CloudFormation resource creation, we will have to insert an explicit dependency on these resources.</p>

<h2 id="build-the-template-file-and-parameters">Build the template file and parameters</h2>

<p>A CloudFormation template has the general form:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="na">Description</span><span class="pi">:</span> <span class="s">AWS AppSync Notes API</span>

<span class="na">Parameters</span><span class="pi">:</span>

<span class="na">Resources</span><span class="pi">:</span>

<span class="na">Outputs</span><span class="pi">:</span></code></pre></figure>

<p>Then, the parameters (the things you need to specify on the command line), resources (the AWS resources that will be created) and outputs (the things that you may need later on that can be output on the command line) are listed under the sections.</p>

<p>I only have one parameter‚Ää‚Äî‚Ääthe API name:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="na">Description</span><span class="pi">:</span> <span class="s">AWS AppSync Notes API</span>

<span class="na">Parameters</span><span class="pi">:</span>
  <span class="na">APIName</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">String</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">API,</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">generate</span><span class="nv"> </span><span class="s">names</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">resources"</span>
    <span class="na">MinLength</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">MaxLength</span><span class="pi">:</span> <span class="m">20</span>
    <span class="na">AllowedPattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">^[a-zA-Z][a-zA-Z0-9_]*$'</span>

<span class="na">Resources</span><span class="pi">:</span>

<span class="na">Outputs</span><span class="pi">:</span></code></pre></figure>

<p>Note that I have to specify this parameter. This ensures that I don‚Äôt try to create resources of the same name as something that exists because it has a default value. You can also create optional parameters as long as you give the parameter a default value.</p>

<h2 id="the-amazon-cognito-resources">The Amazon Cognito resources</h2>

<p>I have two Cognito resources, seven AppSync resources, and a DynamoDB resource to build. Let‚Äôs start with Amazon Cognito. I want to do username and password sign-in and sign-up with a phone-number verification via SMS.</p>

<p>First, let‚Äôs set up an IAM role and policy to allow the user pool to write to SNS:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre>  <span class="na">SNSRole</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::IAM::Role</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">An</span><span class="nv"> </span><span class="s">IAM</span><span class="nv"> </span><span class="s">Role</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">allow</span><span class="nv"> </span><span class="s">Cognito</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">send</span><span class="nv"> </span><span class="s">SNS</span><span class="nv"> </span><span class="s">messages"</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RoleName</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}-cognito-sns-role</span>
      <span class="na">ManagedPolicyArns</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Ref</span><span class="pi">:</span> <span class="s">CognitoSNSPolicy</span>
      <span class="na">AssumeRolePolicyDocument</span><span class="pi">:</span>
        <span class="na">Version</span><span class="pi">:</span> <span class="s">2012-10-17</span>
        <span class="na">Statement</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">Effect</span><span class="pi">:</span> <span class="s">Allow</span>
            <span class="na">Action</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">sts:AssumeRole</span>
            <span class="na">Principal</span><span class="pi">:</span>
              <span class="na">Service</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">cognito-idp.amazonaws.com</span>
    <span class="na">DependsOn</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">CognitoSNSPolicy</span>

  <span class="na">CognitoSNSPolicy</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::IAM::ManagedPolicy</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">Description</span><span class="pi">:</span> <span class="s">Managed policy to allow Amazon Cognito to access SNS</span>
      <span class="na">PolicyDocument</span><span class="pi">:</span>
        <span class="na">Version</span><span class="pi">:</span> <span class="s">2012-10-17</span>
        <span class="na">Statement</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">Effect</span><span class="pi">:</span> <span class="s">Allow</span>
            <span class="na">Action</span><span class="pi">:</span> <span class="s">sns:publish</span>
            <span class="na">Resource</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Notice how I construct the role name based on the APIName parameter. The <code class="highlighter-rouge">!Sub</code> operator substitutes strings before creating the resource. Also, notice how I include a policy within the role. I explicitly depend on the policy so that it exists when I create the role. This is a good model for creating IAM roles that you will need.</p>

<p>Each resource you create has a logical name that is used to reference that resource throughout the CloudFormation template. In this case, my role can be referred to as <code class="highlighter-rouge">SNSRole</code> and the policy by <code class="highlighter-rouge">CognitoSNSPolicy</code>. The <code class="highlighter-rouge">DependsOn</code> section uses this to link the policy to the role.</p>

<p>I also need to create the Amazon Cognito user pool and an application client that AWS AppSync will use:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="na">UserPool</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::Cognito::UserPool"</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">A</span><span class="nv"> </span><span class="s">Cognito</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">pool</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">authenticating</span><span class="nv"> </span><span class="s">users"</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">UserPoolName</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}-user-pool</span>
      <span class="na">AutoVerifiedAttributes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">phone_number</span>
      <span class="na">MfaConfiguration</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ON"</span>
      <span class="na">SmsConfiguration</span><span class="pi">:</span>
        <span class="na">ExternalId</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}-external</span>
        <span class="na">SnsCallerArn</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">SNSRole.Arn</span>
      <span class="na">Schema</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Name</span><span class="pi">:</span> <span class="s">name</span>
          <span class="na">AttributeDataType</span><span class="pi">:</span> <span class="s">String</span>
          <span class="na">Mutable</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">Required</span><span class="pi">:</span> <span class="no">true</span>
        <span class="pi">-</span> <span class="na">Name</span><span class="pi">:</span> <span class="s">email</span>
          <span class="na">AttributeDataType</span><span class="pi">:</span> <span class="s">String</span>
          <span class="na">Mutable</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">Required</span><span class="pi">:</span> <span class="no">true</span>
        <span class="pi">-</span> <span class="na">Name</span><span class="pi">:</span> <span class="s">phone_number</span>
          <span class="na">AttributeDataType</span><span class="pi">:</span> <span class="s">String</span>
          <span class="na">Mutable</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">Required</span><span class="pi">:</span> <span class="no">true</span>

  <span class="na">UserPoolClient</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::Cognito::UserPoolClient"</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">App</span><span class="nv"> </span><span class="s">Client</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">AppSync"</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">ClientName</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}-appsync-client</span>
      <span class="na">GenerateSecret</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">UserPoolId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">UserPool</span></code></pre></figure>

<p>There are a couple of notable items here. First, how do I know what properties I can set? Each resource has a type. You can find a listing of all the types in the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html">CloudFormation documentation</a>. The general form is <em>AWS::product::type</em>. Some products have only one type (like DynamoDB); others have many (check out ApiGateway!). Click on the type in the documentation to get the list of properties that you can set. Some properties are required‚Ää‚Äî‚Ääothers are optional.</p>

<p>Secondly, what‚Äôs with the <code class="highlighter-rouge">!GetAtt</code> and <code class="highlighter-rouge">!Ref</code>? Remember when I showed the dependency tree for this stack? Most of the lines were marked with <code class="highlighter-rouge">Ref</code>‚Ää‚Äî‚Ääa reference. When a resource is created, there are certain output values. Every single resource has a ‚Äúreference‚Äù. Most resources also have a number of ‚Äúattributes‚Äù. You access the reference with <code class="highlighter-rouge">!Ref</code> and the attributes with <code class="highlighter-rouge">!GetAtt</code>. Note the documentation calls these <code class="highlighter-rouge">Fn::Ref</code> and <code class="highlighter-rouge">Fn::GetAtt</code>‚Ää‚Äî‚Ääit‚Äôs the same thing.</p>

<h2 id="create-the-amazon-dynamodb-resources">Create the Amazon DynamoDB resources</h2>

<p>There is only one DynamoDB table in my example:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="na">DynamoDBNotesTable</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::DynamoDB::Table"</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Data</span><span class="nv"> </span><span class="s">store</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">AppSync</span><span class="nv"> </span><span class="s">Notes</span><span class="nv"> </span><span class="s">Type"</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">TableName</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}-notes-table</span>
      <span class="na">AttributeDefinitions</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">AttributeName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">NoteId"</span>
          <span class="na">AttributeType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S"</span>
        <span class="pi">-</span> <span class="na">AttributeName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">UserId"</span>
          <span class="na">AttributeType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">S"</span>
      <span class="na">KeySchema</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">AttributeName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">NoteId"</span>
          <span class="na">KeyType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">HASH"</span>
        <span class="pi">-</span> <span class="na">AttributeName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">UserId"</span>
          <span class="na">KeyType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">RANGE"</span>
      <span class="na">ProvisionedThroughput</span><span class="pi">:</span>
        <span class="na">ReadCapacityUnits</span><span class="pi">:</span> <span class="m">5</span>
        <span class="na">WriteCapacityUnits</span><span class="pi">:</span> <span class="s">5</span></code></pre></figure>

<p>This is fairly straight-forward as templates go. If you want to see a fuller example of what a DynamoDB table definition can look like, take a look at <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html#cfn-dynamodb-table-examples">the documentation</a>.</p>

<h2 id="create-the-aws-appsync-resources">Create the AWS AppSync resources</h2>

<p>There are nine resources to create for the AWS AppSync API:</p>

<ul>
  <li>An IAM policy to allow AppSync to query DynamoDB</li>
  <li>An IAM role that includes the IAM policy</li>
  <li>An AppSync API</li>
  <li>An AppSync Schema</li>
  <li>An AppSync Data Source</li>
  <li>Four AppSync Resolvers</li>
</ul>

<p>Let‚Äôs look at the IAM policy and role first:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="na">DynamoDBRole</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::IAM::Role</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RoleName</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}-appsync-dynamodb-role</span>
      <span class="na">ManagedPolicyArns</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Ref</span><span class="pi">:</span> <span class="s">AppSyncDynamoDBPolicy</span>
      <span class="na">AssumeRolePolicyDocument</span><span class="pi">:</span>
        <span class="na">Version</span><span class="pi">:</span> <span class="s">2012-10-17</span>
        <span class="na">Statement</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">Effect</span><span class="pi">:</span> <span class="s">Allow</span>
            <span class="na">Action</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">sts:AssumeRole</span>
            <span class="na">Principal</span><span class="pi">:</span>
              <span class="na">Service</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">appsync.amazonaws.com</span>
    <span class="na">DependsOn</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">AppSyncDynamoDBPolicy</span>

  <span class="na">AppSyncDynamoDBPolicy</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::IAM::ManagedPolicy</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">Description</span><span class="pi">:</span> <span class="s">Managed policy to allow AWS AppSync to access the tables created by this template.</span>
      <span class="na">Path</span><span class="pi">:</span> <span class="s">/appsync/</span>
      <span class="na">PolicyDocument</span><span class="pi">:</span>
        <span class="na">Version</span><span class="pi">:</span> <span class="s">2012-10-17</span>
        <span class="na">Statement</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">Effect</span><span class="pi">:</span> <span class="s">Allow</span>
            <span class="na">Action</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">dynamodb:GetItem</span>
              <span class="pi">-</span> <span class="s">dynamodb:PutItem</span>
              <span class="pi">-</span> <span class="s">dynamodb:DeleteItem</span>
              <span class="pi">-</span> <span class="s">dynamodb:UpdateItem</span>
              <span class="pi">-</span> <span class="s">dynamodb:Query</span>
              <span class="pi">-</span> <span class="s">dynamodb:Scan</span>
              <span class="pi">-</span> <span class="s">dynamodb:BatchGetItem</span>
              <span class="pi">-</span> <span class="s">dynamodb:BatchWriteItem</span>
            <span class="na">Resource</span><span class="pi">:</span> <span class="kt">!Join</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">"</span><span class="pi">,</span> <span class="pi">[</span> <span class="kt">!GetAtt</span> <span class="nv">DynamoDBNotesTable.Arn</span><span class="pi">,</span> <span class="s2">"</span><span class="s">*"</span> <span class="pi">]</span> <span class="pi">]</span></code></pre></figure>

<p>This is very similar to the SNS Role we looked at earlier. The only addition is that we need to take the <code class="highlighter-rouge">DynamoDBNotesTable</code> ARN, add a wild-card to it, then use that in the policy document. This is done by the <code class="highlighter-rouge">!Join</code> operator.  This, in effect, says ‚ÄúI‚Äôm allowed to do anything to any record within this table‚Äù.</p>

<p>Next, let‚Äôs take a look at the API, schema, and data source:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="na">AppSyncApi</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::AppSync::GraphQLApi"</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">The</span><span class="nv"> </span><span class="s">GraphQL</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Notes</span><span class="nv"> </span><span class="s">App"</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">AuthenticationType</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AMAZON_COGNITO_USER_POOLS"</span>
      <span class="na">Name</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}</span>
      <span class="na">UserPoolConfig</span><span class="pi">:</span>
        <span class="na">UserPoolId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">UserPoolClient</span>
        <span class="na">AwsRegion</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${AWS::Region}</span>
        <span class="na">DefaultAction</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ALLOW"</span>

  <span class="na">AppSyncSchema</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::AppSync::GraphQLSchema"</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">ApiId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.ApiId</span>
      <span class="na">Definition</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">type Note {</span>
          <span class="s">NoteId: ID!</span>
          <span class="s">title: String</span>
          <span class="s">content: String</span>
        <span class="s">}</span>
        <span class="s">type PaginatedNotes {</span>
          <span class="s">notes: [Note!]!</span>
          <span class="s">nextToken: String</span>
        <span class="s">}</span>
        <span class="s">type Query {</span>
          <span class="s">allNotes(limit: Int, nextToken: String): PaginatedNotes!</span>
          <span class="s">getNote(NoteId: ID!): Note</span>
        <span class="s">}</span>
        <span class="s">type Mutation {</span>
          <span class="s">saveNote(NoteId: ID!, title: String!, content: String!): Note</span>
          <span class="s">deleteNote(NoteId: ID!): Note</span>
        <span class="s">}</span>
        <span class="s">type Schema {</span>
          <span class="s">query: Query</span>
          <span class="s">mutation: Mutation</span>
        <span class="s">}</span>
  <span class="na">AppSyncNotesTableDataSource</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::AppSync::DataSource"</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">ApiId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.ApiId</span>
      <span class="na">Name</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${APIName}_notes_table</span>
      <span class="na">Description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">The</span><span class="nv"> </span><span class="s">Notes</span><span class="nv"> </span><span class="s">Table</span><span class="nv"> </span><span class="s">AppSync</span><span class="nv"> </span><span class="s">Data</span><span class="nv"> </span><span class="s">Source"</span>
      <span class="na">Type</span><span class="pi">:</span> <span class="s">AMAZON_DYNAMODB</span>
      <span class="na">ServiceRoleArn</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">DynamoDBRole.Arn</span>
      <span class="na">DynamoDBConfig</span><span class="pi">:</span>
        <span class="na">TableName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">DynamoDBNotesTable</span>
        <span class="na">AwsRegion</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="s">${AWS::Region}</span></code></pre></figure>

<p>There are a couple of things to note here:</p>

<ul>
  <li>There is a pseudo-parameter called <code class="highlighter-rouge">AWS::Region</code>‚Ää‚Äî‚Ääthis is the region you are deploying all your resources in. You don‚Äôt need to specify the region when you are creating resources, but you do need to specify the region when you are linking resources together.</li>
  <li>To embed the schema, you start with the pipe symbol (<code class="highlighter-rouge">|</code>), then a new line, and then put your text. You finish by either an adjustment in the indent level (because of the termination) or a blank line.</li>
  <li>You can cut-and-paste your schema into the CloudFormation template after you have it working.</li>
</ul>

<p>Finally, let‚Äôs take a look at the resolvers:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="na">AppSyncAllNotesQueryResolver</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::AppSync::Resolver"</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">AppSyncSchema</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">ApiId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.ApiId</span>
      <span class="na">TypeName</span><span class="pi">:</span> <span class="s">Query</span>
      <span class="na">FieldName</span><span class="pi">:</span> <span class="s">allNotes</span>
      <span class="na">DataSourceName</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncNotesTableDataSource.Name</span>
      <span class="na">RequestMappingTemplate</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">{</span>
          <span class="s">"version": "2017-02-28",</span>
          <span class="s">"operation": "Query",</span>
          <span class="s">"query": {</span>
            <span class="s">"expression": "UserId = :id",</span>
            <span class="s">"expressionValues": {</span>
              <span class="s">":id": $util.dynamodb.toDynamoDBJson($ctx.identity.sub)</span>
            <span class="s">}</span>
          <span class="s">}</span>
        <span class="s">},</span>
        <span class="s">"limit": $util.defaultIfNull(${ctx.args.limit}, 20),</span>
        <span class="s">"nextToken": $util.toJson(${ctx.args.nextToken})</span>
      <span class="na">ResponseMappingTemplate</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">{</span>
          <span class="s">"notes": $util.toJson($ctx.result.items),</span>
          <span class="s">"nextToken": $util.toJson(${ctx.args.nextToken})</span>
        <span class="s">}</span>
  <span class="na">AppSyncGetNoteQueryResolver</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::AppSync::Resolver"</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">AppSyncSchema</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">ApiId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.ApiId</span>
      <span class="na">TypeName</span><span class="pi">:</span> <span class="s">Query</span>
      <span class="na">FieldName</span><span class="pi">:</span> <span class="s">getNote</span>
      <span class="na">DataSourceName</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncNotesTableDataSource.Name</span>
      <span class="na">RequestMappingTemplate</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">{</span>
          <span class="s">"version": "2012-02-28",</span>
          <span class="s">"operation": "GetItem",</span>
          <span class="s">"key": {</span>
            <span class="s">"NoteId": $util.dynamodb.toDynamoDBJson($ctx.args.NoteId),</span>
            <span class="s">"UserId": $util.dynamodb.toDynamoDBJson($ctx.identity.sub)</span>
          <span class="s">}</span>
        <span class="s">}</span>
      <span class="na">ResponseMappingTemplate</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$util.toJson($ctx.result)"</span>

  <span class="na">AppSyncSaveNoteMutationResolver</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::AppSync::Resolver"</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">AppSyncSchema</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">ApiId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.ApiId</span>
      <span class="na">TypeName</span><span class="pi">:</span> <span class="s">Mutation</span>
      <span class="na">FieldName</span><span class="pi">:</span> <span class="s">saveNote</span>
      <span class="na">DataSourceName</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncNotesTableDataSource.Name</span>
      <span class="na">RequestMappingTemplate</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">{</span>
          <span class="s">"version": "2012-02-28",</span>
          <span class="s">"operation": "PutItem",</span>
          <span class="s">"key": {</span>
            <span class="s">"NoteId": $util.dynamodb.toDynamoDBJson($ctx.args.NoteId),</span>
            <span class="s">"UserId": $util.dynamodb.toDynamoDBJson($ctx.identity.sub)</span>
          <span class="s">},</span>
          <span class="s">"attributeValues": {</span>
            <span class="s">"title": $util.dynamodb.toDynamoDBJson($ctx.args.title),</span>
            <span class="s">"content": $util.dynamodb.toDynamoDBJson($ctx.args.content)</span>
          <span class="s">}</span>
        <span class="s">}</span>
      <span class="na">ResponseMappingTemplate</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$util.toJson($ctx.result)"</span>

  <span class="na">AppSyncDeleteNoteMutationResolver</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AWS::AppSync::Resolver"</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">AppSyncSchema</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">ApiId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.ApiId</span>
      <span class="na">TypeName</span><span class="pi">:</span> <span class="s">Mutation</span>
      <span class="na">FieldName</span><span class="pi">:</span> <span class="s">deleteNote</span>
      <span class="na">DataSourceName</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncNotesTableDataSource.Name</span>
      <span class="na">RequestMappingTemplate</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">{</span>
          <span class="s">"version": "2012-02-28",</span>
          <span class="s">"operation": "DeleteItem",</span>
          <span class="s">"key": {</span>
            <span class="s">"NoteId": $util.dynamodb.toDynamoDBJson($ctx.args.NoteId),</span>
            <span class="s">"UserId": $util.dynamodb.toDynamoDBJson($ctx.identity.sub)</span>
          <span class="s">}</span>
        <span class="s">}</span>
      <span class="na">ResponseMappingTemplate</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$util.toJson($ctx.result)"</span></code></pre></figure>

<p>This is my longest listing because it includes the <a href="https://docs.aws.amazon.com/appsync/latest/devguide/resolver-mapping-template-reference-overview.html">velocity template</a> for each resolver. As before, you can just cut-and-paste the velocity template into the CloudFormation template.</p>

<p>One key thing to note here is that there is no ‚Äúreference‚Äù between a resolver and a schema. However, they depend on one another. You can‚Äôt create a resolver for an operation before the schema has been created. This means an explicit <code class="highlighter-rouge">DependsOn</code> property must be added to the resolver template.</p>

<p>This also has another important effect and it only comes into consideration when you update the schema. The dependency tree is honored on creation. It is not honored fully on update.</p>

<p>If you are adding a new resolver to a type in the schema, you will need to do two updates. The first is for the schema only. The second is to add the resolvers. This is because the resolver creation MUST happen after the type exists in the schema.</p>

<p>There is a simple way around this problem. When you add or remove a query or mutation, change the logical name of the schema. This will cause the updates to happen in the right order. Your existing schema and resolvers are not affected by this change, so you still don‚Äôt suffer any down time from the change.</p>

<h2 id="create-some-outputs">Create some outputs</h2>

<p>The final step in creating a CloudFormation template is to create some outputs. You generally need some information about the created stack. In this case, I‚Äôm interested in the information about the Cognito user pool, DynamoDB table and the AWS AppSync API. Here is my Outputs section:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">Outputs</span><span class="pi">:</span>
  <span class="na">CognitoUserPoolId</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">The Pool ID of the Cognito User Pool</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">UserPool</span>
  <span class="na">CognitoUserPoolClientId</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">The Client ID for AWS AppSync Auth</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">UserPoolClient</span>
  <span class="na">DynamoDBNotesTableName</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">The name of the DynamoDB Table</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">DynamoDBNotesTable</span>
  <span class="na">GraphQLApiEndpoint</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">The URL to the GraphQL Endpoint</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.GraphQLUrl</span>
  <span class="na">GraphQLApiId</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">The API ID of the GraphQL API</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">AppSyncApi.ApiId</span></code></pre></figure>

<p>Check out the <a href="https://gist.github.com/adrianhall/f330a10451f05a529680f32978dddb64">completed CloudFormation template</a>.</p>

<h2 id="create-the-cloudformation-stack">Create the CloudFormation stack</h2>

<p>Before starting with CloudFormation, create an S3 bucket. CloudFormation is asynchronous and you don‚Äôt want to have a partially created stack and then disconnect. It also serves as a repository for the ‚Äúcurrent templates in use‚Äù. The S3 bucket does not need to have any special permissions and you definitely should not make it public to the Internet.</p>

<p>First, transfer the template to your S3 bucket:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws s3 sync . s3://my-bucket-name/cloudformation
</code></pre></div></div>

<p>I keep my templates in a single directory (under source code control) and then sync them all at the same time. I use an S3 bucket for various things, so the CloudFormation templates go into a sub-directory. Next, let‚Äôs validate the template:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws cloudformation validate-template \
  --template-url https://s3-us-west-2.amazonaws.com/my-bucket-name/cloudformation/AWSAppSync.yaml
{
    "CapabilitiesReason": "The following resource(s) require capabilities: [AWS::IAM::ManagedPolicy, AWS::IAM::Role]",
    "Description": "AWS AppSync Notes API",
    "Parameters": [
        {
            "NoEcho": false,
            "Description": "Name of the API - used to generate unique names for resources",
            "ParameterKey": "APIName"
        }
    ],
    "Capabilities": [
        "CAPABILITY_NAMED_IAM"
    ]
}
</code></pre></div></div>

<p>The output shows that everything is fine, but I need to specify some things when I create the stack. If the YAML (or JSON) is not syntactically correct, then you need to adjust your template.</p>

<p>Note that this does not validate that the CloudFormation template can be used to create a stack successfully. I found that most (potentially all) properties are only checked when the stack is created. When you are first creating a stack, you will want to use the console to check that things are created appropriately.</p>

<p>Talking of which, let‚Äôs create the stack:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws cloudformation create-stack --stack-name appsync-notes-api --template-url https://s3-us-west-2.amazonaws.com/adrianha-amazon-scratch/AWSAppSync.yaml --capabilities CAPABILITY_NAMED_IAM --parameters ParameterKey=APIName,ParameterValue=ProdNotesAPI
{
    "StackId": "arn:aws:cloudformation:us-west-2:1234567890:stack/appsync-notes-api/7d4fc430-aaaa-11e8-9963-123456789"
}
</code></pre></div></div>

<p>That came back quickly. CloudFormation is asynchronous. You‚Äôve just kicked off the process. It hasn‚Äôt completed. You can use the <code class="highlighter-rouge">aws cloudformation describe-stacks</code> command to see the current status:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">arn:aws:cloudformation:us-west</span><span class="mi">-2</span><span class="err">:</span><span class="mi">1234567890</span><span class="err">:stack/appsync-notes-api/</span><span class="mi">7</span><span class="err">d</span><span class="mi">4</span><span class="err">fc</span><span class="mi">430</span><span class="err">-aaaa</span><span class="mi">-11e8-9963-123456789</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"Stacks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"StackId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:cloudformation:us-west-2:1234567890:stack/appsync-notes-api/7d4fc430-aaaa-11e8-9963-123456789"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS AppSync Notes API"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"ParameterValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ProdNotesAPI"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"ParameterKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"APIName"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"Outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The API ID of the GraphQL API"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GraphQLApiId"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"r53477kvfzgrziigukivet1234"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Client ID for AWS AppSync Auth"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CognitoUserPoolClientId"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345bblbnqdvs1bgkb7bgue8u"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The name of the DynamoDB Table"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DynamoDBNotesTableName"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ProdNotesAPI-notes-table"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Pool ID of the Cognito User Pool"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CognitoUserPoolId"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us-west-2_vU86ABCDE"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The URL to the GraphQL Endpoint"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GraphQLApiEndpoint"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"OutputValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://abcdefg2djajhh5y4mrckvu7qu.appsync-api.us-west-2.amazonaws.com/graphql"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"EnableTerminationProtection"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"CreationTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-04-13T21:47:04.111Z"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Capabilities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"CAPABILITY_NAMED_IAM"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"StackName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"appsync-notes-api"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"NotificationARNs"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"StackStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CREATE_COMPLETE"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"DisableRollback"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"RollbackConfiguration"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>This stack was completed successfully. I can see all the outputs that I‚Äôve defined. I can also see this same information on the AWS CloudFormation console:</p>

<p><img src="/assets/images/2018-04-17-image2.png" alt="" /></p>

<p>When developing the CloudFormation stack, I can click on the stack name and get more information. This is especially useful when there are errors in the template. I can see exactly what property of what resource is causing the problem. My general workflow is</p>

<ol>
  <li>Edit the template.</li>
  <li>Use <code class="highlighter-rouge">aws sync</code> to copy the template to S3.</li>
  <li>Use <code class="highlighter-rouge">aws cloudformation create-stack</code> to kick off the create.</li>
  <li>Monitor the creation using the console.</li>
  <li>If there are errors, then adjust the template.</li>
  <li>Use <code class="highlighter-rouge">aws cloudformation delete-stack</code> to delete the stack.</li>
  <li>Repeat from step 2 as needed.</li>
  <li>Check in the template to my source code repository.</li>
</ol>

<p>One you have a good stack created, you can use <code class="highlighter-rouge">aws cloudformation update-stack</code> (instead of <code class="highlighter-rouge">create-stack</code>) to make changes. This will cause the minimal amount of change in the stack, which reduces downtime on your production backend.</p>

<h2 id="other-ways-to-build-cloudformation-templates">Other ways to build CloudFormation templates</h2>

<p>CloudFormation has <a href="https://console.aws.amazon.com/cloudformation/designer/home">a designer</a> integrated into it. The designer is visual and includes access to all the properties as you are editing the underlying YAML or JSON format. It‚Äôs a good visual representation of your stack.</p>

<p><img src="/assets/images/2018-04-17-image3.png" alt="" /></p>

<p>I found the creation process much slower using the designer. However, it‚Äôs good to visualize an existing CloudFormation template that has been deployed as it is built in. There are also a bunch of DSLs for handling CloudFormation:</p>

<ul>
  <li><a href="https://github.com/cloudtools/troposphere">https://github.com/cloudtools/troposphere</a></li>
  <li><a href="https://github.com/bazaarvoice/cloudformation-ruby-dsl">https://github.com/bazaarvoice/cloudformation-ruby-dsl</a></li>
</ul>

<p>Instead of writing the YAML or JSON, you are writing in the DSL (domain specific language) provided by the tool. I don‚Äôt find this an improvement. However, if you like writing templates in Python or Ruby instead of YAML or JSON, this might be for you.</p>

<p>There are also template repositories, including <a href="https://github.com/awslabs/aws-cloudformation-templates">the one maintained by AWS</a>. I find the template repositories more useful, but they depend on the fact that you already know how to configure the service. In many cases, that means going through a configuration exercise on the service prior to integrating it into your template so you know what properties you need to set.</p>

<p>Ultimately, CloudFormation is a great tool for configuring resources in a repeatable way; especially for services that have a lot of interactions (like AWS AppSync). It enables you to do repeatable deployments and to check your cloud backend definition into source code control‚Ää‚Äî‚Ääboth good things. This is a tool that you will want in your hands.</p>

<!-- AWS Links -->

<!-- Consoles -->

<!-- My Links -->

:ET